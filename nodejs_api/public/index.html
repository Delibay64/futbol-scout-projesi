<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scout System - Vue.js Frontend</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }

        .player-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2) !important;
        }

        .tech-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 0.7rem;
        }

        .player-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            font-weight: bold;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- Header -->
        <div class="text-center mb-5">
            <h1 class="text-white display-4 fw-bold mb-2">
                <i class="bi bi-people"></i> Scout System
            </h1>
            <p class="text-white-50 fs-5">Vue.js 3 + Node.js REST API + PostgreSQL</p>
            <div class="mt-3">
                <span class="badge bg-success me-2">
                    <i class="bi bi-circle-fill text-success-emphasis"></i> Vue.js 3
                </span>
                <span class="badge bg-warning text-dark me-2">
                    <i class="bi bi-circle-fill text-warning-emphasis"></i> Node.js
                </span>
                <span class="badge bg-info me-2">
                    <i class="bi bi-circle-fill text-info-emphasis"></i> REST API
                </span>
                <span class="badge bg-primary">
                    <i class="bi bi-circle-fill text-primary-emphasis"></i> PostgreSQL
                </span>
            </div>
        </div>

        <!-- İstatistikler -->
        <div class="row mb-4" v-if="stats">
            <div class="col-md-3 mb-3">
                <div class="stat-box text-white text-center">
                    <i class="bi bi-people display-6 mb-2"></i>
                    <h3 class="mb-0">{{ stats.totalPlayers }}</h3>
                    <small class="text-white-50">Toplam Oyuncu</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-box text-white text-center">
                    <i class="bi bi-cash-stack display-6 mb-2"></i>
                    <h3 class="mb-0">€{{ formatNumber(stats.totalValue) }}</h3>
                    <small class="text-white-50">Toplam Değer</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-box text-white text-center">
                    <i class="bi bi-graph-up display-6 mb-2"></i>
                    <h3 class="mb-0">€{{ formatNumber(stats.avgValue) }}</h3>
                    <small class="text-white-50">Ortalama Değer</small>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="stat-box text-white text-center">
                    <i class="bi bi-trophy display-6 mb-2"></i>
                    <h3 class="mb-0">{{ stats.maxAge }}</h3>
                    <small class="text-white-50">En Yaşlı</small>
                </div>
            </div>
        </div>

        <!-- Arama ve Filtre -->
        <div class="card shadow mb-4">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-search"></i>
                            </span>
                            <input
                                type="text"
                                class="form-control"
                                v-model="searchQuery"
                                @input="filterPlayers"
                                placeholder="Oyuncu ara (isim, pozisyon)..."
                            >
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" v-model="positionFilter" @change="filterPlayers">
                            <option value="">Tüm Pozisyonlar</option>
                            <option v-for="pos in positions" :key="pos" :value="pos">{{ pos }}</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" v-model="sortBy" @change="sortPlayers">
                            <option value="name">İsme Göre</option>
                            <option value="age">Yaşa Göre</option>
                            <option value="value">Değere Göre</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div v-if="loading" class="loading-spinner">
            <div class="spinner-border text-white" style="width: 4rem; height: 4rem;" role="status">
                <span class="visually-hidden">Yükleniyor...</span>
            </div>
        </div>

        <!-- Error State -->
        <div v-else-if="error" class="alert alert-danger shadow" role="alert">
            <h5 class="alert-heading">
                <i class="bi bi-exclamation-triangle"></i> Hata!
            </h5>
            <p>{{ error }}</p>
            <hr>
            <small>Node.js API çalışmıyor olabilir. <code>START_NODEJS_API.bat</code> dosyasını çalıştırın.</small>
            <button class="btn btn-danger mt-3" @click="fetchPlayers">
                <i class="bi bi-arrow-clockwise"></i> Tekrar Dene
            </button>
        </div>

        <!-- Oyuncu Listesi -->
        <div v-else class="row">
            <div class="col-md-6 col-lg-4 mb-4" v-for="player in filteredPlayers" :key="player.player_id">
                <div class="card player-card shadow h-100 position-relative">
                    <span class="badge bg-success tech-badge">REST API</span>
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="player-avatar me-3">
                                {{ getInitials(player.full_name) }}
                            </div>
                            <div>
                                <h5 class="card-title mb-1">{{ player.full_name }}</h5>
                                <small class="text-muted">ID: {{ player.player_id }}</small>
                            </div>
                        </div>

                        <table class="table table-sm table-borderless mb-0">
                            <tr>
                                <td width="40%">
                                    <i class="bi bi-geo-alt text-primary"></i> Pozisyon
                                </td>
                                <td>
                                    <span class="badge bg-primary">{{ player.position || '-' }}</span>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <i class="bi bi-calendar text-success"></i> Yaş
                                </td>
                                <td><strong>{{ player.age || '-' }}</strong></td>
                            </tr>
                            <tr>
                                <td>
                                    <i class="bi bi-cash text-warning"></i> Piyasa Değeri
                                </td>
                                <td>
                                    <span v-if="player.current_market_value" class="badge bg-success">
                                        €{{ formatNumber(player.current_market_value) }}
                                    </span>
                                    <span v-else class="text-muted">-</span>
                                </td>
                            </tr>
                            <tr v-if="player.team_name">
                                <td>
                                    <i class="bi bi-shield text-info"></i> Takım
                                </td>
                                <td><small>{{ player.team_name }}</small></td>
                            </tr>
                        </table>
                    </div>
                    <div class="card-footer bg-light">
                        <button class="btn btn-sm btn-outline-primary w-100" @click="selectPlayer(player)">
                            <i class="bi bi-eye"></i> Detayları Gör
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sonuç Bulunamadı -->
            <div v-if="filteredPlayers.length === 0" class="col-12">
                <div class="alert alert-warning text-center shadow">
                    <i class="bi bi-search display-1 text-warning"></i>
                    <h4 class="mt-3">Oyuncu Bulunamadı</h4>
                    <p class="text-muted">Arama kriterlerinizi değiştirip tekrar deneyin.</p>
                </div>
            </div>
        </div>

        <!-- Detay Modal -->
        <div class="modal fade" id="playerModal" tabindex="-1" v-if="selectedPlayer">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">
                            <i class="bi bi-person-badge"></i> {{ selectedPlayer.full_name }}
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center mb-4">
                            <div class="player-avatar mx-auto" style="width: 120px; height: 120px; font-size: 3rem;">
                                {{ getInitials(selectedPlayer.full_name) }}
                            </div>
                            <h4 class="mt-3">{{ selectedPlayer.full_name }}</h4>
                            <span class="badge bg-primary fs-6">{{ selectedPlayer.position || 'Belirsiz' }}</span>
                        </div>

                        <table class="table table-bordered">
                            <tr>
                                <th width="40%">Oyuncu ID</th>
                                <td>{{ selectedPlayer.player_id }}</td>
                            </tr>
                            <tr>
                                <th>Yaş</th>
                                <td>{{ selectedPlayer.age || '-' }}</td>
                            </tr>
                            <tr>
                                <th>Piyasa Değeri</th>
                                <td>
                                    <span v-if="selectedPlayer.current_market_value" class="badge bg-success fs-6">
                                        €{{ formatNumber(selectedPlayer.current_market_value) }}
                                    </span>
                                    <span v-else class="text-muted">Belirtilmemiş</span>
                                </td>
                            </tr>
                            <tr v-if="selectedPlayer.team_name">
                                <th>Takım</th>
                                <td>{{ selectedPlayer.team_name }}</td>
                            </tr>
                        </table>

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i>
                            <strong>Veri Kaynağı:</strong> PostgreSQL → Node.js REST API → Vue.js
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Vue.js App -->
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    players: [],
                    filteredPlayers: [],
                    loading: false,
                    error: null,
                    searchQuery: '',
                    positionFilter: '',
                    sortBy: 'name',
                    selectedPlayer: null,
                    stats: null
                }
            },
            computed: {
                positions() {
                    const uniquePositions = [...new Set(this.players.map(p => p.position).filter(p => p))];
                    return uniquePositions.sort();
                }
            },
            methods: {
                async fetchPlayers() {
                    this.loading = true;
                    this.error = null;

                    try {
                        const response = await axios.get('http://localhost:3000/api/players');

                        if (response.data.success) {
                            this.players = response.data.players;
                            this.filteredPlayers = this.players;
                            this.calculateStats();
                        } else {
                            this.error = 'Veri çekilemedi';
                        }
                    } catch (err) {
                        this.error = err.message || 'Bağlantı hatası';
                        console.error('API Error:', err);
                    } finally {
                        this.loading = false;
                    }
                },

                filterPlayers() {
                    let result = this.players;

                    // Pozisyona göre filtrele
                    if (this.positionFilter) {
                        result = result.filter(p => p.position === this.positionFilter);
                    }

                    // Arama sorgusuna göre filtrele
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        result = result.filter(p =>
                            p.full_name.toLowerCase().includes(query) ||
                            (p.position && p.position.toLowerCase().includes(query))
                        );
                    }

                    this.filteredPlayers = result;
                    this.sortPlayers();
                },

                sortPlayers() {
                    const sorted = [...this.filteredPlayers];

                    switch(this.sortBy) {
                        case 'name':
                            sorted.sort((a, b) => a.full_name.localeCompare(b.full_name));
                            break;
                        case 'age':
                            sorted.sort((a, b) => (b.age || 0) - (a.age || 0));
                            break;
                        case 'value':
                            sorted.sort((a, b) => (b.current_market_value || 0) - (a.current_market_value || 0));
                            break;
                    }

                    this.filteredPlayers = sorted;
                },

                calculateStats() {
                    const total = this.players.length;
                    const totalValue = this.players.reduce((sum, p) => sum + (p.current_market_value || 0), 0);
                    const avgValue = total > 0 ? totalValue / total : 0;
                    const maxAge = Math.max(...this.players.map(p => p.age || 0));

                    this.stats = {
                        totalPlayers: total,
                        totalValue: totalValue,
                        avgValue: avgValue,
                        maxAge: maxAge
                    };
                },

                formatNumber(num) {
                    if (!num) return '0';
                    return new Intl.NumberFormat('tr-TR').format(num);
                },

                getInitials(name) {
                    if (!name) return '?';
                    const parts = name.split(' ');
                    if (parts.length >= 2) {
                        return parts[0][0] + parts[parts.length - 1][0];
                    }
                    return name.substring(0, 2).toUpperCase();
                },

                selectPlayer(player) {
                    this.selectedPlayer = player;
                    const modal = new bootstrap.Modal(document.getElementById('playerModal'));
                    modal.show();
                }
            },
            mounted() {
                this.fetchPlayers();
            }
        }).mount('#app');
    </script>
</body>
</html>
